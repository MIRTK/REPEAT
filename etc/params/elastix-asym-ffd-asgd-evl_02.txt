// Elastix configuration template file
//
// Patterns '<column>' are substituted by the respective values in
// the parameters CSV file generated by elastix-asym-ffd-full.gen script.
//
// Uses adaptive stochastic gradient descent instead of standard or conjugate
// gradient descent. See elastix manual on page 29 for advise regarding suitable
// values for SP_alpha, SP_A, and SP_a.
// (http://elastix.isi.uu.nl/download/elastix_manual_v4.8.pdf)
//
// Version: elastix 4.8

(ShowExactMetricValue "false")
(UseFastAndLowMemoryVersion "true")
(UseDirectionCosines "true")

(WriteResultImage "false")
(ResultImagePixelType "short")
(ResultImageFormat "nii.gz")
(CompressResultImage "true")

(FixedInternalImagePixelType "float")
(MovingInternalImagePixelType "float")
(FixedImageDimension 3)
(MovingImageDimension 3)
(DefaultPixelValue <bg>)

(ErodeFixedMask "false")
(ErodeMovingMask "false")

(NumberOfResolutions 4)
(ImagePyramidSchedule 8 8 8  4 4 4  2 2 2  1 1 1)
(Registration "MultiMetricMultiResolutionRegistration")
(FixedImagePyramid "Fixed<pyramid>ImagePyramid")
(MovingImagePyramid "Moving<pyramid>ImagePyramid")
(Interpolator "<interp>Interpolator")
(ResampleInterpolator "Final<interp>Interpolator")
(BSplineInterpolationOrder 3)
(FixedImageBSplineInterpolationOrder 3)
(MovingImageBSplineInterpolationOrder 3)
(FinalBSplineInterpolationOrder 3)
(Resampler "DefaultResampler")

(FinalGridSpacingInPhysicalUnits <ds>)
(GridSpacingSchedule 8.0 4.0 2.0 1.0)
(Transform "BSplineTransform")
(BSplineTransformSplineOrder 3)
(UseCyclicTransform "false")
(HowToCombineTransforms "Add") // IRTK model, see Rueckert et al. (1999)

(Metric "<sim>" "TransformBendingEnergyPenalty")
(NumberOfSamplesForSelfHessian 100000)  // TransformBendingEnergyPenalty
(FixedKernelBSplineOrder 3)
(MovingKernelBSplineOrder 3)
(NumberOfHistogramBins <bins>)
(NumberOfFixedHistogramBins <bins>)
(NumberOfMovingHistogramBins <bins>)
(FixedLimitRangeRatio 0.01)
(MovingLimitRangeRatio 0.01)
(UseRelativeWeights "false")
(Metric0Weight 1)
(Metric1Weight <be>)

(Optimizer "AdaptiveStochasticGradientDescent")
(AutomaticParameterEstimation "<auto>")
(ASGDParameterEstimationMethod "Original")
(SigmoidInitialTime 0)
(SigmoidScaleFactor 0.1)
(MaxBandCovSize 192)
(NumberOfBandStructureSamples 10)
(NumberOfGradientMeasurements 0)
(NumberOfJacobianMeasurements 1000 5000 10000 20000)
(NumberOfSamplesForExactGradient 100000)
(SP_alpha <alpha>)
(SP_A <A>)
(SP_a <a>)
(MaximumNumberOfIterations <iters>)
(MaximumStepLength <step>)
(NoiseCompensation "true")
(UseAdaptiveStepSizes "<adaptive>")  // unused when ImageSampler is RandomCoordinate

(ImageSampler "Random")
(NewSamplesEveryIteration "true")
(NumberOfSpatialSamples 500 1000 2000 4000)
(CheckNumberOfSamples "true")
(UseRandomSampleRegion "false")
(MaximumNumberOfSamplingAttempts 3)
